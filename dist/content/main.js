function U(t,e){let n;return(...o)=>{clearTimeout(n),n=window.setTimeout(()=>t(...o),e)}}function A(t){const e=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(e){const n=o=>("0"+parseInt(o).toString(16)).slice(-2);return"#"+n(e[1])+n(e[2])+n(e[3])}return t}function I(){const t=document.createElement("div");return t.className="findfont-floating-button",t.textContent="ff",t}function j(){const t=document.createElement("div");t.className="findfont-info-panel";const e=document.createElement("div");e.className="findfont-panel-header";const n=document.createElement("span");n.className="findfont-panel-title",n.textContent="ðŸ§¾ Find Font";const o=document.createElement("button");o.className="findfont-copy-button findfont-copy-all-button",o.title="Copy All Font Properties",o.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect x="3" y="3" width="9" height="9" rx="1" stroke="#888" stroke-width="1.2"/>
    <rect x="5" y="5" width="9" height="9" rx="1" stroke="#888" stroke-width="1.2" fill="#fff"/>
  </svg>`,o.style.opacity="0",o.style.pointerEvents="none",n.appendChild(o);const i=document.createElement("button");i.className="findfont-close-button",i.textContent="Ã—";const l=document.createElement("div");l.className="findfont-panel-content",l.id="fontInfoContent";const c=()=>{console.log("Mouse enter - showing copy button"),o.style.opacity="1",o.style.pointerEvents="auto"},s=()=>{o.classList.contains("copied")||(o.style.opacity="0",o.style.pointerEvents="none")};return e.addEventListener("mouseenter",c),e.addEventListener("mouseleave",s),e.appendChild(n),e.appendChild(i),t.appendChild(e),t.appendChild(l),{panel:t,closeButton:i,content:l,cleanup:()=>{e.removeEventListener("mouseenter",c),e.removeEventListener("mouseleave",s)},mouseEnterHandler:c,mouseLeaveHandler:s}}function w(t,e,n,o){const i=document.createElement("div");i.className="findfont-info-section";const l=document.createElement("div");if(l.className="findfont-section-title",l.textContent=t,n&&o){const s=document.createElement("button");s.className="findfont-copy-button",s.title=`Copy ${n}`,s.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect x="3" y="3" width="9" height="9" rx="1" stroke="#888" stroke-width="1.2"/>
  <rect x="5" y="5" width="9" height="9" rx="1" stroke="#888" stroke-width="1.2" fill="#fff"/>
</svg>`,s.style.opacity="0",s.style.pointerEvents="none";const u=y=>{y.stopPropagation();const N=`${n}: ${o}`;navigator.clipboard.writeText(N),s.classList.add("copied"),setTimeout(()=>s.classList.remove("copied"),1e3)},f=()=>{s.style.opacity="1",s.style.pointerEvents="auto"},m=()=>{s.style.opacity="0",s.style.pointerEvents="none"};s.addEventListener("click",u),i.addEventListener("mouseenter",f),i.addEventListener("mouseleave",m),l.appendChild(s)}const c=document.createElement("div");return c.className="findfont-section-content",c.appendChild(e),i.appendChild(l),i.appendChild(c),i}function _(t){const e=document.createElement("div");e.className="findfont-color-display";const n=document.createElement("span");n.className="findfont-color-box",n.style.backgroundColor=t;const o=document.createElement("span");return o.textContent=t,e.appendChild(n),e.appendChild(o),e}function G(t){if(t.length===0)return null;const e=document.createElement("div");e.className="findfont-fallback-fonts";const n=document.createElement("div");n.className="findfont-fallback-header",n.textContent="Fallback Fonts",e.appendChild(n);const o=3,i=t.slice(0,o),l=t.slice(o),c=document.createElement("div");c.className="findfont-fallback-wrapper";const s=document.createElement("div");s.className="findfont-fallback-text",s.textContent=i.join(", "),c.appendChild(s);let u;if(l.length>0){const f=document.createElement("button");f.className="findfont-fallback-toggle",f.textContent=`+${l.length}`;let m=!1;u=y=>{y.stopPropagation(),m=!m,m?(s.textContent=t.join(", "),f.textContent="less"):(s.textContent=i.join(", "),f.textContent=`+${l.length}`)},f.addEventListener("click",u),c.appendChild(f)}return e.appendChild(c),e}function V(t){const e=document.createElement("div");e.className="findfont-font-preview";const n=parseInt(t.fontSize),o=24,i=12;let l;n>o?l=o:n<i?l=i:l=n;const c=document.createElement("div");c.className="findfont-preview-text",c.style.cssText=`
    font-family: ${t.fontFamily};
    font-size: ${l}px;
    font-weight: ${t.fontWeight};
    font-style: ${t.fontStyle};
    color: ${t.color};
    line-height: 1.3;
    text-align: center;
    margin-bottom: 6px;
  `,c.innerHTML=`
    <div style="font-size: 0.85em;">The quick brown fox jumps over the lazy dog</div>
  `;const s=document.createElement("div");return s.textContent="Preview",s.className="findfont-preview-label",l!==n&&(s.textContent=`Preview (scaled from ${t.fontSize})`),l!==n&&(s.textContent=`Preview (scaled from ${t.fontSize})`),e.appendChild(c),e.appendChild(s),e}function Z(t){try{const e=window.getComputedStyle(t);return{fontFamily:e.fontFamily,fontSize:e.fontSize,fontWeight:e.fontWeight,fontStyle:e.fontStyle,textDecorationLine:e.textDecorationLine,textDecorationStyle:e.textDecorationStyle,textDecorationThickness:e.textDecorationThickness,color:e.color,lineHeight:e.lineHeight,letterSpacing:e.letterSpacing}}catch(e){return console.warn("FindFont: Failed to get font info:",e),null}}function J(t){const e=t.split(",").map(n=>n.trim().replace(/['"]/g,""));return{primary:e[0],fallbacks:e.slice(1)}}function Q(t){const e=t.toLowerCase();return e.includes("-apple-system")||e.includes("system-ui")?"System Font":e.includes("segoe ui")?"Windows System Font":e.includes("roboto")||e.includes("noto")?"Android System Font":["roboto","open sans","lato","montserrat","source sans pro","raleway","ubuntu","lora","merriweather","nunito","playfair display","oswald","poppins","inter","fira sans","pt sans","work sans"].some(i=>e.includes(i))?"Google Fonts":["proxima nova","minion pro","myriad pro","source serif pro","acumin","brandon grotesque","futura pt","trade gothic","museo","ff din","adelle","freight text"].some(i=>e.includes(i))?"Adobe Fonts":e.includes("helvetica")||e.includes("times")||e.includes("arial")||e.includes("courier")?"Standard Font":""}function X(t){const e=Q(t),n=t.split(",")[0].trim().replace(/['"]/g,"");return e?`${n} (${e})`:n}function Y(t){return t.fontStyle!=="normal"?t.fontStyle:t.fontFamily.toLowerCase().includes("italic")?"normal (italic font)":"normal"}let p=null;function K(t){try{p=t;const e=document.getElementById("fontInfoContent");if(!e){console.warn("FindFont: Info panel content element not found");return}e.innerHTML="";const n=A(t.color),{primary:o,fallbacks:i}=J(t.fontFamily),l=w("Font Family",document.createTextNode(X(t.fontFamily)),"font-family",t.fontFamily),c=G(i);if(c){const T=l.querySelector(".findfont-section-content");T&&T.appendChild(c)}e.appendChild(l);const s=document.createElement("div");s.className="findfont-size-weight-container";const u=w("Size",document.createTextNode(t.fontSize),"font-size",t.fontSize),f=w("Weight",document.createTextNode(t.fontWeight),"font-weight",t.fontWeight);s.appendChild(u),s.appendChild(f),e.appendChild(s);const m=w("Color",_(n),"color",n);e.appendChild(m);const y=document.createElement("div");y.innerHTML=Y(t);const N=w("Style",y,"font-style",t.fontStyle);e.appendChild(N);const O=V(t);e.appendChild(O);const v=document.querySelector(".findfont-copy-all-button");v&&(v.onclick=null,v.onclick=()=>{const T=e.querySelectorAll(".findfont-info-section");let g="";p&&(g+=`font-family: ${p.fontFamily};
`,g+=`font-size: ${p.fontSize};
`,g+=`font-weight: ${p.fontWeight};
`,g+=`color: ${A(p.color)};
`,g+=`font-style: ${p.fontStyle};
`),navigator.clipboard.writeText(g.trim()),v.classList.add("copied"),setTimeout(()=>v.classList.remove("copied"),1e3)})}catch(e){console.error("FindFont: Failed to update info panel:",e)}}const d=10,b=32;function ee(t,e,n){const o=t.right+d,i=t.top-b-d,l=window.innerWidth-b-d,c=Math.min(Math.max(d,o),l),s=Math.max(d,i);e.style.left=`${c}px`,e.style.top=`${s}px`,n.classList.contains("show")&&$(c,s,n)}function $(t,e,n){const o=n.offsetWidth||280,i=n.offsetHeight||200;let l=t+b+d,c=e;l+o>window.innerWidth&&(l=t-o-d),l<d&&(l=t,c=e+b+d),c+i>window.innerHeight&&(c=e-i-d),l=Math.max(d,Math.min(l,window.innerWidth-o-d)),c=Math.max(d,Math.min(c,window.innerHeight-i-d)),n.style.left=`${l}px`,n.style.top=`${c}px`}class te{constructor(){this.listeners=[]}add(e,n,o,i){e.addEventListener(n,o,i),this.listeners.push({element:e,event:n,handler:o,options:i})}removeAll(){this.listeners.forEach(({element:e,event:n,handler:o,options:i})=>{e.removeEventListener(n,o,i)}),this.listeners=[]}remove(e,n,o){e.removeEventListener(n,o),this.listeners=this.listeners.filter(i=>!(i.element===e&&i.event===n&&i.handler===o))}}const h=new te;let a,r,R,B,W,D,P,x,S,F,C=[],L=!1;function z(t){return!!(t.matches('input, textarea, [contenteditable="true"]')||t.closest('input, textarea, [contenteditable="true"]')||t.closest(".findfont-floating-button, .findfont-info-panel"))}function ne(t){if(!t.rangeCount)return!1;const n=t.getRangeAt(0).commonAncestorContainer,o=n.nodeType===Node.ELEMENT_NODE?n:n.parentElement;return o?!!(o.closest("input")||o.closest("textarea")||o.closest('[contenteditable="true"]')):!1}function oe(){if(window.getSelection){const t=window.getSelection();t&&t.rangeCount>0&&t.removeAllRanges()}}function ie(){a.style.display="none",r.style.display="none",r.classList.remove("show")}function se(){const t=parseFloat(a.style.left),e=parseFloat(a.style.top),n=10,i=window.innerWidth-32-n,l=Math.min(Math.max(n,t),i),c=Math.max(n,e);(l!==t||c!==e)&&(a.style.left=`${l}px`,a.style.top=`${c}px`),r.classList.contains("show")&&$(l,c,r)}function le(){r.style.display="block",r.offsetHeight,r.classList.add("show");const t=parseFloat(a.style.left),e=parseFloat(a.style.top);$(t,e,r),de()}function H(){r.classList.remove("show"),setTimeout(()=>{r.style.display="none",q()},250),a.style.display="none",setTimeout(()=>{oe()},50),E()}function ce(){B=t=>{t.stopPropagation(),H(),a.style.display="none",k()},W=t=>{t.stopPropagation(),r.classList.contains("show")?H():le()},D=t=>{const e=t.target;z(e)||e.closest(".findfont-floating-button, .findfont-info-panel")||re(t)},P=()=>{a.style.display==="flex"&&se()},h.add(R,"click",B),h.add(a,"click",W),h.add(document,"mouseup",D),h.add(window,"resize",P),h.add(window,"beforeunload",M),h.add(document,"visibilitychange",ae)}function ae(){document.visibilityState==="hidden"&&(k(),E())}const re=U(t=>{var n;const e=window.getSelection();if(e&&e.toString().trim()){if(ne(e))return;const o=t.target;if(z(o))return;const l=e.getRangeAt(0).getBoundingClientRect();a.style.display="flex",ee(l,a,r);const c=(n=e.focusNode)==null?void 0:n.parentElement;if(c instanceof HTMLElement)try{const s=Z(c);s&&K(s)}catch(s){console.error("FindFont: Failed to process selected element:",s)}}else a.style.display="none",r.style.display="none",E(),k()},150);function de(){L||(x=t=>{const e=t.target;!e.closest(".findfont-info-panel")&&!e.closest(".findfont-floating-button")&&!z(e)&&H()},document.addEventListener("click",x,!1),L=!0)}function E(){x&&L&&(document.removeEventListener("click",x,!1),x=null,L=!1)}function fe(){var t,e;typeof chrome!="undefined"&&chrome.runtime&&(S=()=>{M()},(t=chrome.runtime.onSuspend)==null||t.addListener(S),F=(n,o,i)=>{n.action==="cleanup"&&(M(),i({success:!0}))},(e=chrome.runtime.onMessage)==null||e.addListener(F))}function ue(){typeof chrome!="undefined"&&chrome.runtime&&(S&&chrome.runtime.onSuspend&&chrome.runtime.onSuspend.removeListener(S),F&&chrome.runtime.onMessage&&chrome.runtime.onMessage.removeListener(F))}function q(){C.forEach(e=>e()),C=[];const t=document.getElementById("fontInfoContent");t&&(t.querySelectorAll(".findfont-info-section").forEach(o=>{o.cleanup&&o.cleanup()}),t.querySelectorAll(".findfont-fallback-fonts").forEach(o=>{o.cleanup&&o.cleanup()}),t.innerHTML="")}function k(){ie()}function M(){k(),E(),q(),ue(),h.removeAll(),a!=null&&a.parentNode&&a.parentNode.removeChild(a),r!=null&&r.parentNode&&r.parentNode.removeChild(r)}function me(){E(),C.forEach(o=>o()),C.length=0,a&&document.body.contains(a)&&document.body.removeChild(a),r&&document.body.contains(r)&&document.body.removeChild(r);const t=j(),{panel:e,closeButton:n}=t;"cleanup"in t&&typeof t.cleanup=="function"&&C.push(t.cleanup),a=I(),r=e,R=n,document.body.appendChild(a),document.body.appendChild(r),ce(),fe()}me();
